!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),r=n(o);i(6),window.H5ImgUploader=r.default,t.default=r.default},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _ImgPicker=__webpack_require__(2),_ImgPicker2=_interopRequireDefault(_ImgPicker),_ImgEditor=__webpack_require__(3),_ImgEditor2=_interopRequireDefault(_ImgEditor),_Uploader=__webpack_require__(4),_Uploader2=_interopRequireDefault(_Uploader),_Img=__webpack_require__(5),_Img2=_interopRequireDefault(_Img),F=function(e,t,i,n){this.name=e,this.images=t,this.curtImg=null,this.list=null,this.container=i,this.opts=$.extend({mul:!1,setCoverField:!0,coverFieldName:"image",mime:"image/*",type:/image.(png|jpeg|gif|jpg)/,maxSize:4194304,loading:"http://ui.jc001.cn/images/loading.gif",upload:"/upload/save",fileName:"media",dataFormat:"file",transData:{},onUpload:function(e){},onSend:function(e){}},n),this.isSetCover=!1,this.imgPicker=new _ImgPicker2.default(i,{mul:this.opts.mul,mime:this.opts.mime}),this.imgEditor=new _ImgEditor2.default({maxWidth:this.opts.maxWidth,quality:this.opts.quality,dataFormat:this.opts.dataFormat})};F.prototype={init:function(){this.container.addClass("h5_uploads"),this.container.append($('<div class="up_selector icon-plus2 glyphicon glyphicon-camera"></div><div class="up_list"></div>')),this.list=$(".up_list",this.container);var e=!1;this.images&&this.images.forEach(function(t){if(0!=t.length){var i=e=this.createImage(t);i.setValue(t)}});var t=this;$(".up_selector",this.container).click(function(){var e=t.list.find(".up_item").size()>0&&0==t.opts.mul;return!e&&void t.imgPicker.select(function(e){var i=t.createImage(t.opts.loading);t._render(e,i)})})},_isCanAdd:function(){return 0==this.list.has(".up_item").size()||1==this.opts.mul},_render:function(e,t){var i=this;this.opts.maxWidth||this.opts.opacity?this.imgEditor.getResult(e,function(e,n){t.setUrl("base64"==i.opts.dataFormat?e:URL.createObjectURL(e)),i._upload(e,n,t)}):(t.setUrl(URL.createObjectURL(e)),i._upload(e,e,t))},_upload:function _upload(data,file,img){var self=this,progress=img.progress;data="base64d"==this.opts.dataFormat?data.substr(data.indexOf(",")+1):data,(0,_Uploader2.default)(this.opts.upload,data,{fieldName:this.opts.fileName,fileName:file.name,format:self.opts.dataFormat,transData:self.opts.transData,onInit:function(){progress.show(),progress.val(0)},onProgress:function(e,t){progress.val(e/t*100)},onSuccess:function onSuccess(xhr){var response=eval("("+xhr.responseText+")");200==response.code?(progress.val(100),progress.hide(),img.setValue(response.data.url),self.opts.onUpload(response.data.url)):(alert("上传失败, "+response.message),img.remove())},onError:function(e){alert("上传失败("+e.status+")"),img.remove()},onSend:function(e){self.opts.onSend(e)}})},getFieldName:function(){return this.opts.mul&&this.opts.setCoverField&&!this.isSetCover?(this.isSetCover=!0,this.opts.coverFieldName):this.opts.mul?this.name+"[]":this.name},createImage:function(e){var t=this,i=this.getFieldName(),n=new _Img2.default(i,e,this.list);return n.image.click(function(){t.imgPicker.select(function(e){t._render(e,n)})}),n.deleteImg.click(function(){if(n.remove(),t.isSetCover&&0==$("input[name="+t.opts.coverFieldName+"]",t.list).size()){var e=$(">:first-child",t.list);$("input[type=hidden]",e).attr("name",t.opts.coverFieldName)}event.stopPropagation()}),n}},exports.default=F},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.opts=$.extend({mul:!0,mime:"image/*",type:/image.(png|jpeg|gif|jpg)/,maxSize:16777216},t),this.callback=function(e){},this.init(e)};i.prototype={init:function(e){var t=$('<input type="file" style="width:0; height:0;" '+(this.opts.mul?"multiple":"")+' accept="'+this.opts.mime+'">');e.prepend(t);var i=this;t.change(function(e){e=e||window.event,i._getFiles(e.target.files)}),this.input=t},select:function(e){this.callback=e,this.input.click()},_getFiles:function(e){for(var t,i=this.opts.type,n=this.opts.maxSize,o=0;t=e[o];o++)0==t.type.length&&t.name.length>0&&!/\.(jpg|png|gif)$/.test(t.name.toLowerCase())||t.type.length>0&&!i.test(t.type.toLowerCase())?alert('"'+t.name+'" 类型不是图片'):t.size>n?alert('"'+t.name+'" 大于'+n/1024/1024+"M"):this.callback(t)}},t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){this.opts=$.extend({maxWidth:0,quality:.7,dataFormat:"base64"},e)};i.prototype={getResult:function(e,t){var i=this,n=parseInt(this.opts.maxWidth),o=parseFloat(this.opts.quality),r=URL.createObjectURL(e);0==o&&(o=1);var a=new Image;a.addEventListener("load",function(){var s=a.width,l=a.height,u=s/l;n>0&&s>n&&(s=n,l=parseInt(s/u));var p=document.createElement("canvas"),c=p.getContext("2d");if(p.width=s,p.height=l,c.drawImage(a,0,0,s,l),URL.revokeObjectURL(r),"base64"==i.opts.dataFormat){var d=p.toDataURL(e.type,o);p.width=0,p.height=0,p=null,t(d,e)}else p.toBlob(function(i){t(i,e)},e.type,o)},!1),a.src=r}},t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){var n=new XMLHttpRequest;if(!n.upload)return!1;var o=$.extend({method:"POST",fileName:"media",transData:{},onInit:function(){},onProgress:function(e,t){},onError:function(e){},onSuccess:function(e){},onSend:function(e){}},i);o.onInit(),n.upload.addEventListener("progress",function(e){e.lengthComputable&&o.onProgress(e.loaded,e.total)},!1),n.onReadyStateChange=function(e){4==n.readyState&&(200==n.status?o.onSuccess(n):o.onError(n))},n.open(o.method,e,!0);var r=new FormData;r.append(o.fieldName,t,o.fileName),"base64"==o.format&&r.append("fileName",o.fileName),r.append("uploadFormat",o.format);for(var a in o.transData)o.transData.hasOwnProperty(a)&&r.append(a,o.transData[a]);return o.onSend(r),n.send(r),!0}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){var n=$('<div class="up_item"><input type="hidden" name="'+e+'" /><img src="'+t+'" /><progress max="100" value="0"></progress><a name="none" style="" class="up_close">×</a></div>');i.append(n),this.root=n,this.deleteImg=$("a",n),this.progress=$("progress",n),this.image=$("img",n),this.value=$("input",n)};i.prototype={setUrl:function(e){this.image.attr("src",e)},setValue:function(e){this.value.val(e)},remove:function(){this.root.remove()}},t.default=i},function(e,t,i){var n=i(7);"string"==typeof n&&(n=[[e.id,n,""]]);i(9)(n,{});n.locals&&(e.exports=n.locals)},function(e,t,i){t=e.exports=i(8)(),t.push([e.id,'.h5_uploads:after{content:".";display:block;height:0;clear:both;visibility:hidden}.h5_uploads{zoom:1}.h5_uploads .up_selector{float:left;width:80px;height:80px;margin:5px;cursor:pointer;font-size:40px;background:#fff;color:gray;line-height:80px;text-align:center;border:1px solid #ccc}.h5_uploads .up_list{display:inline}.h5_uploads .up_item{width:80px;height:80px;margin:5px;overflow:hidden;position:relative;float:left;display:flex;flex-flow:row wrap;align-items:center;justify-content:center;vertical-align:middle}.h5_uploads .up_item a{color:#fff;position:absolute;top:-3px;right:-3px;background:#000;opacity:.8;cursor:pointer;font-size:12px;padding:0 4px;line-height:16px}.h5_uploads .up_item progress{width:100%;margin-top:5px;position:absolute;bottom:0;left:0;opacity:.5;display:none}.h5_uploads .up_item img{max-width:100%;cursor:pointer}',""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];i[2]?e.push("@media "+i[2]+"{"+i[1]+"}"):e.push(i[1])}return e.join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&n[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),e.push(a))}},e}},function(e,t,i){function n(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=f[n.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](n.parts[r]);for(;r<n.parts.length;r++)o.parts.push(u(n.parts[r],t))}else{for(var a=[],r=0;r<n.parts.length;r++)a.push(u(n.parts[r],t));f[n.id]={id:n.id,refs:1,parts:a}}}}function o(e){for(var t=[],i={},n=0;n<e.length;n++){var o=e[n],r=o[0],a=o[1],s=o[2],l=o[3],u={css:a,media:s,sourceMap:l};i[r]?i[r].parts.push(u):t.push(i[r]={id:r,parts:[u]})}return t}function r(e,t){var i=g(),n=y[y.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function s(e){var t=document.createElement("style");return t.type="text/css",r(e,t),t}function l(e){var t=document.createElement("link");return t.rel="stylesheet",r(e,t),t}function u(e,t){var i,n,o;if(t.singleton){var r=_++;i=v||(v=s(t)),n=p.bind(null,i,r,!1),o=p.bind(null,i,r,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(t),n=d.bind(null,i),o=function(){a(i),i.href&&URL.revokeObjectURL(i.href)}):(i=s(t),n=c.bind(null,i),o=function(){a(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}function p(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=b(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function c(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function d(e,t){var i=t.css,n=t.sourceMap;n&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var o=new Blob([i],{type:"text/css"}),r=e.href;e.href=URL.createObjectURL(o),r&&URL.revokeObjectURL(r)}var f={},h=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},m=h(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),g=h(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,_=0,y=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=m()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var i=o(e);return n(i,t),function(e){for(var r=[],a=0;a<i.length;a++){var s=i[a],l=f[s.id];l.refs--,r.push(l)}if(e){var u=o(e);n(u,t)}for(var a=0;a<r.length;a++){var l=r[a];if(0===l.refs){for(var p=0;p<l.parts.length;p++)l.parts[p]();delete f[l.id]}}}};var b=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()}]);